<%= form_with model: @base_shift, url: (@base_shift.persisted? ? roster_base_shift_path(@roster, @base_shift) : roster_base_shifts_path(@roster)), class: "space-y-6" do |form| %>
  <% if @base_shift.errors.any? %>
    <div class="rounded-md bg-red-50 p-4">
      <h3 class="text-sm font-medium text-red-800">
        <%= pluralize(@base_shift.errors.count, "error") %> prevented this shift from being saved:
      </h3>
      <ul class="mt-2 list-disc list-inside text-sm text-red-700">
        <% @base_shift.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <%= form.label :day_of_week, "Day of Week", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :day_of_week, BaseShift.day_of_weeks.keys.map { |k| [k.titleize, k] }, { selected: params[:day_of_week] || @base_shift.day_of_week }, class: "block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
    </div>

    <div>
      <%= form.label :work_section_id, "Section / Role", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <% 
         sections = current_user.work_sections.map { |ws| [ws.name, ws.id] } 
         # Add standard shift types as fallback option groups if we wanted, but for now let's just use selects
      %>
      <div class="space-y-2">
        <%= form.select :work_section_id, sections, { include_blank: "None (Use Shift Type)" }, class: "block w-full px-3 py-2 border border-blue-500 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
        
        <div class="relative flex items-center">
          <div class="flex-grow border-t border-gray-300"></div>
          <span class="flex-shrink-0 mx-2 text-gray-400 text-xs">OR Default Type</span>
          <div class="flex-grow border-t border-gray-300"></div>
        </div>

        <%= form.select :shift_type, BaseShift.shift_types.keys.map { |k| [k.titleize, k] }, {}, class: "block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <%= form.label :start_time, "Start Time", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.time_field :start_time, class: "block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
      <p class="mt-1 text-xs text-gray-500">Shift start time</p>
    </div>

    <div>
      <%= form.label :end_time, "End Time", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.time_field :end_time, class: "block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
      <p class="mt-1 text-xs text-gray-500">Shift end time (can be next day)</p>
    </div>
  </div>

  <div class="flex items-center justify-between pt-4 border-t border-gray-200">
    <%= link_to "Cancel", roster_path(@roster), class: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
    <%= form.submit @base_shift.new_record? ? "Create Shift" : "Update Shift", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
  </div>
<% end %>
